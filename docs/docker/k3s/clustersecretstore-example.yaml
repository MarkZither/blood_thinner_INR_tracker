apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: azure-keyvault-clusterstore
  # NOTE: Create this in the cluster once. It points to Azure Key Vault and uses a k8s secret for credentials.
spec:
  provider:
    azurekv:
      tenantId: "{{ .tenantId }}"        # Optional templating when using a helm chart; replace with actual tenant if creating by hand
      vaultUrl: "https://<your-key-vault-name>.vault.azure.net/"
      authType: "ServicePrincipal"       # ServicePrincipal or WorkloadIdentity (if supported)
      clientId: "{{ .clientId }}"        # If templating, otherwise omitted and provided via secretRef
      # Use a Kubernetes Secret for the clientSecret to avoid storing it here
      clientSecret:
        secretRef:
          name: azure-kv-creds
          namespace: kube-system
          key: clientSecret

      # Alternatively you can reference the whole secret as credentialSecret
      # credentialSecret:
      #   name: azure-kv-creds
      #   namespace: kube-system

  # Optional: provider-specific config (timeouts/retry) could go here

# Usage notes:
# 1. Create a Kubernetes Secret named `azure-kv-creds` in namespace `kube-system` with keys:
#    - tenantId
#    - clientId
#    - clientSecret
# 2. Seal that secret (if storing in git) using Bitnami SealedSecrets. See sealedsecret-bootstrap-example.yaml for format.
# 3. Apply this ClusterSecretStore to your cluster.

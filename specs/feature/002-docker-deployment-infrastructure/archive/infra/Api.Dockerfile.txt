# Original src/BloodThinnerTracker.Api/Dockerfile (archived as text)
# Build stage - Use .NET 10 SDK (RC2)
FROM mcr.microsoft.com/dotnet/sdk:10.0 AS build
WORKDIR /src

# Copy project files for dependency restoration
COPY ["src/BloodThinnerTracker.Api/BloodThinnerTracker.Api.csproj", "BloodThinnerTracker.Api/"]
COPY ["src/BloodThinnerTracker.Shared/BloodThinnerTracker.Shared.csproj", "BloodThinnerTracker.Shared/"]
COPY ["src/BloodThinnerTracker.ServiceDefaults/BloodThinnerTracker.ServiceDefaults.csproj", "BloodThinnerTracker.ServiceDefaults/"]
COPY ["Directory.Build.props", "./"]
COPY ["global.json", "./"]

RUN dotnet restore "BloodThinnerTracker.Api/BloodThinnerTracker.Api.csproj"

# Copy all source code
COPY src/ .

# Build and publish the application
WORKDIR "/src/BloodThinnerTracker.Api"
RUN dotnet publish "BloodThinnerTracker.Api.csproj" -c Release -o /app/publish /p:UseAppHost=false

FROM mcr.microsoft.com/dotnet/aspnet:10.0 AS runtime
WORKDIR /app
COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "BloodThinnerTracker.Api.dll"]
